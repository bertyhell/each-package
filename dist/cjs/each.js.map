{"version":3,"sources":["each.js"],"sourcesContent":["const path = require('path');\nconst Iterator = require('fs-iterator');\nconst assign = require('just-extend');\nconst spawn = require('cross-spawn-cb');\n\nconst ignores = ['.git', 'node_modules', '.yarn'];\n\nmodule.exports = function each(command, args, options, callback) {\n  let depth = typeof options.depth === 'undefined' ? Infinity : options.depth;\n  if (depth !== Infinity) depth++; // depth is relative to first level of packages\n\n  const iterator = new Iterator(process.cwd(), {\n    filter: function filter(entry) {\n      if (entry.stats.isDirectory()) return !~ignores.indexOf(entry.basename);\n      if (entry.stats.isFile()) return entry.basename === 'package.json';\n    },\n    depth: depth,\n  });\n\n  const results = [];\n  iterator.forEach(\n    (entry, callback) => {\n      if (!entry.stats.isFile()) return callback();\n      !options.header || options.header(entry, command, args);\n\n      const spawnOptions = assign({}, options, { cwd: path.dirname(entry.fullPath) });\n      spawn(command, args, spawnOptions, (err, res) => {\n        results.push({ path: entry.path, error: err, result: res });\n        callback();\n      });\n    },\n    { callbacks: true, concurrency: 1 },\n    function iteratorCallback(err) {\n      err ? callback(err) : callback(null, results);\n    }\n  );\n};\n"],"names":["path","require","Iterator","assign","spawn","ignores","module","exports","each","command","args","options","callback","depth","Infinity","iterator","process","cwd","filter","entry","stats","isDirectory","indexOf","basename","isFile","results","forEach","header","spawnOptions","dirname","fullPath","err","res","push","error","result","callbacks","concurrency","iteratorCallback"],"mappings":";AAAA,IAAMA,OAAOC,QAAQ;AACrB,IAAMC,WAAWD,QAAQ;AACzB,IAAME,SAASF,QAAQ;AACvB,IAAMG,QAAQH,QAAQ;AAEtB,IAAMI,UAAU;IAAC;IAAQ;IAAgB;CAAQ;AAEjDC,OAAOC,OAAO,GAAG,SAASC,KAAKC,OAAO,EAAEC,IAAI,EAAEC,OAAO,EAAEC,QAAQ;IAC7D,IAAIC,QAAQ,OAAOF,QAAQE,KAAK,KAAK,cAAcC,WAAWH,QAAQE,KAAK;IAC3E,IAAIA,UAAUC,UAAUD,SAAS,+CAA+C;IAEhF,IAAME,WAAW,IAAIb,SAASc,QAAQC,GAAG,IAAI;QAC3CC,QAAQ,SAASA,OAAOC,KAAK;YAC3B,IAAIA,MAAMC,KAAK,CAACC,WAAW,IAAI,OAAO,CAAC,CAAChB,QAAQiB,OAAO,CAACH,MAAMI,QAAQ;YACtE,IAAIJ,MAAMC,KAAK,CAACI,MAAM,IAAI,OAAOL,MAAMI,QAAQ,KAAK;QACtD;QACAV,OAAOA;IACT;IAEA,IAAMY,UAAU,EAAE;IAClBV,SAASW,OAAO,CACd,SAACP,OAAOP;QACN,IAAI,CAACO,MAAMC,KAAK,CAACI,MAAM,IAAI,OAAOZ;QAClC,CAACD,QAAQgB,MAAM,IAAIhB,QAAQgB,MAAM,CAACR,OAAOV,SAASC;QAElD,IAAMkB,eAAezB,OAAO,CAAC,GAAGQ,SAAS;YAAEM,KAAKjB,KAAK6B,OAAO,CAACV,MAAMW,QAAQ;QAAE;QAC7E1B,MAAMK,SAASC,MAAMkB,cAAc,SAACG,KAAKC;YACvCP,QAAQQ,IAAI,CAAC;gBAAEjC,MAAMmB,MAAMnB,IAAI;gBAAEkC,OAAOH;gBAAKI,QAAQH;YAAI;YACzDpB;QACF;IACF,GACA;QAAEwB,WAAW;QAAMC,aAAa;IAAE,GAClC,SAASC,iBAAiBP,GAAG;QAC3BA,MAAMnB,SAASmB,OAAOnB,SAAS,MAAMa;IACvC;AAEJ"}